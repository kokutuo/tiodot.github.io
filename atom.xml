<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>学习是一种信仰</title>
  <subtitle>我们终其一生都在摆脱他人的期待，追求自由。</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://xchb.work/"/>
  <updated>2017-04-08T05:12:40.000Z</updated>
  <id>http://xchb.work/</id>
  
  <author>
    <name>swxy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>hexo忽略文件(skip_render)配置</title>
    <link href="http://xchb.work/2017/04/08/hexo%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6-skip-render-%E9%85%8D%E7%BD%AE/"/>
    <id>http://xchb.work/2017/04/08/hexo忽略文件-skip-render-配置/</id>
    <published>2017-04-08T04:20:04.000Z</published>
    <updated>2017-04-08T05:12:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>需要在<code>source</code>目录下填加一个<code>demo</code>目录放一些示例文件，hexo默认会编译<code>source</code>目录下的所有文件。但demo目录并不需要编译，<code>_config.yml</code>有提供一个配置项<code>skip_render</code>, 官网说明：</p>
<blockquote>
<p>skip_render：跳过指定文件的渲染，您可使用<a href="https://github.com/isaacs/minimatch" target="_blank" rel="external">glob表达式</a>来匹配路径。</p>
</blockquote>
<p>glob表达式链接的是<code>minimatch</code>，说明路径匹配用的应该是<code>minimatch</code>这个npm模块包来完成的。需要指出的是这里面配置的路径都是相对<code>source</code>目录的。<br><a id="more"></a></p>
<ol>
<li><p>如何需要跳过<code>source</code>目录下文件的编译:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 跳过单个文件</span></div><div class="line"><span class="string">skip_render:</span> test.html</div><div class="line"></div><div class="line"><span class="comment">// 跳过所有的html的文件</span></div><div class="line"><span class="string">skip_render:</span> <span class="string">'*.html'</span></div></pre></td></tr></table></figure>
</li>
<li><p>跳过某一目录下的所有文件:</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">skip_render:</span> test<span class="comment">/*</span></div></pre></td></tr></table></figure>
</li>
<li><p>需要跳过某一目录下的所有文件和子目录时：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">skip_render:</span> test<span class="comment">/**</span></div></pre></td></tr></table></figure>
</li>
<li><p>跳过多个目录，或者多个文件：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">//</span> 最新版本的hexo，用这个好使</div><div class="line">skip_render: [<span class="string">'*.html'</span>, demo<span class="regexp">/**, test/</span>*]</div></pre></td></tr></table></figure>
</li>
</ol>
<p>看见有人是说是这样，反正我试不管事，可能的版本的原因：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 我试了试，不管事啊。</span></div><div class="line">skip_render:</div><div class="line">    -<span class="ruby"> test1/*.html</span></div><div class="line">    -<span class="ruby"> test2/**</span></div></pre></td></tr></table></figure></p>
<p>ps：</p>
<ol>
<li>如果设置<code>skip_render</code>不起作用，可以先执行<code>hexo clean</code>清除一下缓存。</li>
<li>如果跳过多个目录编译失败，请尝试更新<code>hexo</code>, 在<code>source</code>同级目录中执行<code>npm update hexo</code></li>
<li>如果需要查看是否成功跳过编译，可以在编译的时候加上<code>--debug</code>:<figure class="highlight verilog"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo <span class="keyword">generate</span> --debug</div></pre></td></tr></table></figure>
</li>
</ol>
<p>关注打印出来的<code>Rendering xxxx</code> 中的东西。<br>以下是我在<code>skip_render</code>中加入<code>test/*</code>的前后对比：</p>
<p><img src="/img/hexo/before.png" alt="添加test/*前"></p>
<p><img src="/img/hexo/after.png" alt="添加test/*后"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;需要在&lt;code&gt;source&lt;/code&gt;目录下填加一个&lt;code&gt;demo&lt;/code&gt;目录放一些示例文件，hexo默认会编译&lt;code&gt;source&lt;/code&gt;目录下的所有文件。但demo目录并不需要编译，&lt;code&gt;_config.yml&lt;/code&gt;有提供一个配置项&lt;code&gt;skip_render&lt;/code&gt;, 官网说明：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;skip_render：跳过指定文件的渲染，您可使用&lt;a href=&quot;https://github.com/isaacs/minimatch&quot;&gt;glob表达式&lt;/a&gt;来匹配路径。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;glob表达式链接的是&lt;code&gt;minimatch&lt;/code&gt;，说明路径匹配用的应该是&lt;code&gt;minimatch&lt;/code&gt;这个npm模块包来完成的。需要指出的是这里面配置的路径都是相对&lt;code&gt;source&lt;/code&gt;目录的。&lt;br&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="http://xchb.work/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>React+webpack2环境搭建</title>
    <link href="http://xchb.work/2017/04/02/React-webpack2%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <id>http://xchb.work/2017/04/02/React-webpack2环境搭建/</id>
    <published>2017-04-02T02:55:18.000Z</published>
    <updated>2017-04-02T03:19:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>记录环境搭建过程中遇到的问题：</p>
<ol>
<li><code>No PostCSS Config found in</code></li>
<li><code>react-hot-loader</code>不更新页面</li>
</ol>
<a id="more"></a>
<ol>
<li><p><code>No PostCSS Config found in</code><br>使用<code>postcss</code>需要配置一个config文件，但是也可以不使用postcss，所以删除相关配置即可</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attribute">test</span>: /\.css$/,</div><div class="line">    use: [ <span class="string">'style-loader'</span>, <span class="string">'css-loader?modules'</span>, <span class="comment">/*'postcss-loader'*/</span>],</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p><code>react-hot-loader</code>不更新页面<br>对应的<code>index.js</code>为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123;AppContainer&#125; <span class="keyword">from</span> <span class="string">'react-hot-loader'</span>;</div><div class="line"></div><div class="line"><span class="keyword">import</span> Loop <span class="keyword">from</span> <span class="string">'./loop'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">Component</span>) =&gt;</span> &#123;</div><div class="line">    ReactDOM.render(</div><div class="line">        <span class="xml"><span class="tag">&lt;<span class="name">AppContainer</span>&gt;</span></span></div><div class="line">            <span class="tag">&lt;<span class="name">Component</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">AppContainer</span>&gt;</span>,</div><div class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</div><div class="line">    );</div><div class="line">&#125;;</div><div class="line"></div><div class="line">render(Loop);</div><div class="line"></div><div class="line"><span class="comment">// 不更新页面</span></div><div class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</div><div class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">'./loop'</span>, () =&gt; &#123;</div><div class="line">        render(Loop);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>改为：<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">....</div><div class="line"><span class="keyword">if</span> (<span class="keyword">module</span>.hot) &#123;</div><div class="line">    <span class="keyword">module</span>.hot.accept();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>或者：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</div><div class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">'./loop'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        <span class="regexp">//</span> 重新<span class="built_in">require</span></div><div class="line">        const NextLoop = <span class="built_in">require</span>(<span class="string">'./loop'</span>).<span class="keyword">default</span>;</div><div class="line">        render(NextLoop);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h1><ol>
<li><a href="https://webpack.js.org/guides/hmr-react/" target="_blank" rel="external">Hot Module Replacement - React</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录环境搭建过程中遇到的问题：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;No PostCSS Config found in&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;react-hot-loader&lt;/code&gt;不更新页面&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="React" scheme="http://xchb.work/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>React生命周期</title>
    <link href="http://xchb.work/2017/03/30/React%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    <id>http://xchb.work/2017/03/30/React生命周期/</id>
    <published>2017-03-30T06:07:08.000Z</published>
    <updated>2017-04-05T09:36:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>探索问题：</p>
<ol>
<li>React生命周期有哪些，各自在什么阶段触发</li>
<li>哪些阶段可以使用重新设置状态，例如使用<code>setState</code></li>
</ol>
<a id="more"></a>
<h1 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h1><p>React的生命周期可以分为四个阶段：初始化(initialization)，挂载(mounting)，更新(updating)，销毁(unmounting)</p>
<h2 id="初始化-initialization"><a href="#初始化-initialization" class="headerlink" title="初始化(initialization)"></a>初始化(initialization)</h2><h3 id="getDefaultProps"><a href="#getDefaultProps" class="headerlink" title="getDefaultProps"></a>getDefaultProps</h3><p>如果没有传递<code>props</code>, 会使用<code>getDefaultProps</code>返回的对象</p>
<h3 id="getInitialState"><a href="#getInitialState" class="headerlink" title="getInitialState"></a>getInitialState</h3><p>初始化<code>state</code>，在ES6中可以直接使用<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">class Input extend Component &#123;</div><div class="line">    constructor(props) &#123;</div><div class="line">        super(props);</div><div class="line">        this.<span class="keyword">state</span> = &#123;</div><div class="line">            txt: ''</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    // 或者直接赋值</div><div class="line">    <span class="keyword">state</span> = &#123;</div><div class="line">        txt: ''</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="挂载-mounting"><a href="#挂载-mounting" class="headerlink" title="挂载(mounting)"></a>挂载(mounting)</h2><h3 id="componentWillUpdate"><a href="#componentWillUpdate" class="headerlink" title="componentWillUpdate"></a>componentWillUpdate</h3><p>在<code>render</code>之前执行，可以处理一下业务逻辑相关的操作</p>
<h3 id="render"><a href="#render" class="headerlink" title="render"></a>render</h3><p>首次渲染到DOM中</p>
<h3 id="componentDidMount"><a href="#componentDidMount" class="headerlink" title="componentDidMount"></a>componentDidMount</h3><p>在<code>render</code>之后执行，此时可以获取dom元素，可以初始化一些dom操作相关</p>
<h2 id="更新-updating"><a href="#更新-updating" class="headerlink" title="更新(updating)"></a>更新(updating)</h2><h3 id="componentWillReceiveProps"><a href="#componentWillReceiveProps" class="headerlink" title="componentWillReceiveProps"></a>componentWillReceiveProps</h3><p>如果父级组件传递下来的<code>props</code>发生变化时，会被触发</p>
<h3 id="componentWillUpdate-1"><a href="#componentWillUpdate-1" class="headerlink" title="componentWillUpdate"></a>componentWillUpdate</h3><p>可以通过返回值来决定是否需要重新渲染改组件，可以用于做一些性能优化</p>
<h3 id="render-1"><a href="#render-1" class="headerlink" title="render"></a>render</h3><p>组件<code>state</code>或者<code>props</code>发生变化时，重新渲染组件</p>
<h3 id="componentDidUpdate"><a href="#componentDidUpdate" class="headerlink" title="componentDidUpdate"></a>componentDidUpdate</h3><p>组件状态已经更新到dom上，此时可以执行一些dom相关的操作</p>
<h2 id="销毁-unmounting"><a href="#销毁-unmounting" class="headerlink" title="销毁(unmounting)"></a>销毁(unmounting)</h2><h3 id="componentWillUnmount"><a href="#componentWillUnmount" class="headerlink" title="componentWillUnmount"></a>componentWillUnmount</h3><p>组件从dom中销毁时会触发，用于执行一些清理</p>
<h1 id="重设状态"><a href="#重设状态" class="headerlink" title="重设状态"></a>重设状态</h1><p>一般state用于描述组件的状态，而prop表示父级组件传递下来的属性，所以重新设置状态可以分为两种情况：</p>
<ol>
<li>改变组件自身的<code>state</code></li>
<li>改变父级组件的<code>state</code>, 即相当于改变<code>prop</code></li>
</ol>
<p>这两种情况都会触发组件的重新渲染，但有些阶段却不允许改变状态，因为会使组件无限渲染</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="http://www.codeceo.com/article/reactjs-life-circle-event.html" target="_blank" rel="external">ReactJS 生命周期、数据流与事件</a></li>
<li><a href="https://medium.com/react-ecosystem/react-components-lifecycle-ce09239010df" target="_blank" rel="external">React component’s lifecycle</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;探索问题：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;React生命周期有哪些，各自在什么阶段触发&lt;/li&gt;
&lt;li&gt;哪些阶段可以使用重新设置状态，例如使用&lt;code&gt;setState&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="React" scheme="http://xchb.work/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>ES6之Iteration</title>
    <link href="http://xchb.work/2017/03/23/ES6%E4%B9%8BIteration/"/>
    <id>http://xchb.work/2017/03/23/ES6之Iteration/</id>
    <published>2017-03-23T03:00:05.000Z</published>
    <updated>2017-03-26T03:06:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>探索问题：</p>
<ol>
<li>为什么ES6中数组，字符串等是可迭代的，而对象却是不可迭代？直观感受就是数组和字符串都可以用<code>for...of</code>，而对象却不可以。</li>
<li>实现一个最小化的迭代器。</li>
</ol>
<a id="more"></a>
<p>JavaScript中可以迭代的两种情景：</p>
<ol>
<li>程序层级：检测程序的结构</li>
<li>数据层级：检测程序中所有的数据</li>
</ol>
<p>这两个层级过于抽象，尤其是<code>程序层级</code>，可以借助js中的数组来理解：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> dt = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]; <span class="comment">// 数据层</span></div><div class="line">dt.func = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;; <span class="comment">// 程序层</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> dt) <span class="built_in">console</span>.log(xs[i]); <span class="comment">// 1, 2, 3, 4, () =&gt; &#123;&#125;</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> dt) <span class="built_in">console</span>.log(i); <span class="comment">// 1, 2, 3, 4</span></div></pre></td></tr></table></figure></p>
<p>像ES5中的<code>for...in</code>可以检测对象中的所有属性，针对的大多数就是程序层级。为了解决这个问题，ES6中引入了<code>for...of</code>.</p>
<blockquote>
<p>那既然可以用<code>for...in</code>遍历对象，为何就不能用<code>for...of</code>了？</p>
</blockquote>
<p>如果设计可以迭代对象，也就意味着会混淆上面两个层级，简单的理解就是一个对象不可能仅仅只是像数组一样存储一组数据。如果混合上述两个概念，也就是说可以使用<code>for...of</code>遍历对象，意味着只能遍历对象的数据，而不能遍历其他程序层级的属性，相当于把对象当成一个数据层级来处理，这很可能会破坏代码结构。</p>
<p>为了解决对象不可以使用<code>for...of</code>遍历的问题，ES6中引入了一个新的概念<code>Map</code>，使用<code>Map</code>创建的key-value对就可以迭代遍历。</p>
<blockquote>
<p>当然也可以做一个工具函数，来实现对对象的迭代。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">objectEntries</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> propKeys = <span class="built_in">Reflect</span>.ownKeys(obj);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        [<span class="built_in">Symbol</span>.iterator]() &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;,</div><div class="line">        next() &#123;</div><div class="line">            <span class="keyword">if</span> (index &lt; propKeys.length) &#123;</div><div class="line">                <span class="keyword">const</span> key = propKeys[index];</div><div class="line">                index++;</div><div class="line">                <span class="keyword">return</span> &#123; <span class="attr">value</span>: [key, obj[key]] &#125;;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span> &#125;;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">first</span>: <span class="string">'Jane'</span>, <span class="attr">last</span>: <span class="string">'Doe'</span> &#125;;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key,value] <span class="keyword">of</span> objectEntries(obj)) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;key&#125;</span>: <span class="subst">$&#123;value&#125;</span>`</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Output:</span></div><div class="line"><span class="comment">// first: Jane</span></div><div class="line"><span class="comment">// last: Doe</span></div></pre></td></tr></table></figure>
<p>PS.可以思考一下为什么不扩充在Object原型链上？</p>
<h1 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h1><ol>
<li><a href="http://exploringjs.com/es6/ch_iteration.html#sec_plain-objects-not-iterable" target="_blank" rel="external">Plain objects are not iterable</a></li>
<li><a href="http://stackoverflow.com/a/38777177" target="_blank" rel="external">Why are Objects not Iterable in JavaScript?</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;探索问题：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;为什么ES6中数组，字符串等是可迭代的，而对象却是不可迭代？直观感受就是数组和字符串都可以用&lt;code&gt;for...of&lt;/code&gt;，而对象却不可以。&lt;/li&gt;
&lt;li&gt;实现一个最小化的迭代器。&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="JS" scheme="http://xchb.work/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>WebStorm之JSCS</title>
    <link href="http://xchb.work/2017/03/11/WebStorm%E4%B9%8BJSCS/"/>
    <id>http://xchb.work/2017/03/11/WebStorm之JSCS/</id>
    <published>2017-03-11T02:04:26.000Z</published>
    <updated>2017-03-12T08:50:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>在开发代码时，通常需要配置一些额外的代码质量校验工具来保证代码质量，像我们这边使用的就是<a href="http://fecs.baidu.com/" target="_blank" rel="external">fecs</a>。因为平常都是用Webstorm来开发，正好<code>fecs</code>有提供这样的<a href="https://github.com/leeight/Baidu-FE-Code-Style#webstorm" target="_blank" rel="external">插件</a>，用起来却也很方便。</p>
<a id="more"></a>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ol>
<li>把代码下载或者<code>git clone</code>到本地某个目录</li>
<li>然后全局安装<code>fecs</code>, <code>npm i -g fecs</code></li>
<li>然后修改jscs的配置, 目录指向下载的<code>Baidu-FE-Code-Style</code>即可</li>
<li>然后可能还需要指定一个<code>jscs</code>的配置文件，可以在<code>Baidu-FE-Code-Style</code>下新建一个<code>.jscsrc</code>文件，内容随意一个json就行，<code>fecs</code>并不会用到这个配置，我配置的是：<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"preset"</span>: <span class="string">"airbnb"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>每次文件文件有变更时，会执行<code>Baidu-FE-Code-Style</code>工程目录下的<code>[bin/jscs](https://github.com/leeight/Baidu-FE-Code-Style/blob/master/bin/jscs)</code>, 最主要的代码:<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">spawn(<span class="string">'fecs'</span>,</div><div class="line">    [<span class="string">'--silent'</span>, <span class="string">'--reporter=baidu'</span>, <span class="string">'--format=checkstyle'</span>, <span class="keyword">file</span>],</div><div class="line">    &#123;stdio: <span class="string">'inherit'</span>&#125;);</div></pre></td></tr></table></figure></p>
<p>即执行全局的fecs命令，<code>--fotmat=checkstyle</code>是指输入符合webstorm规范的xml形式的检测结果，内容大致为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">checkstyle</span> <span class="attr">version</span>=<span class="string">"4.3"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">file</span> <span class="attr">name</span>=<span class="string">"/Users/xxx/project/util.js"</span> <span class="attr">count</span>=<span class="string">"1"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">error</span> <span class="attr">line</span>=<span class="string">"107"</span> <span class="attr">column</span>=<span class="string">"24"</span> <span class="attr">severity</span>=<span class="string">"error"</span> <span class="attr">source</span>=<span class="string">"fecs"</span> <span class="attr">message</span>=<span class="string">"  JS021: [强制] 不得省略语句结束的分号。"</span> <span class="attr">rule</span>=<span class="string">"semi"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">file</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">checkstyle</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>webstorm会根据error标签中的信息展示相关的提示。</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>由于webstorm只支持给统一设置检测错误提示的颜色，所以这里没有办法根据<code>severity</code>的不用取值,例如<code>error</code>, <code>warning</code>等展示不同的颜色。</p>
<h1 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h1><p><a href="https://github.com/leeight/Baidu-FE-Code-Style" target="_blank" rel="external">leeight/Baidu-FE-Code-Style</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在开发代码时，通常需要配置一些额外的代码质量校验工具来保证代码质量，像我们这边使用的就是&lt;a href=&quot;http://fecs.baidu.com/&quot;&gt;fecs&lt;/a&gt;。因为平常都是用Webstorm来开发，正好&lt;code&gt;fecs&lt;/code&gt;有提供这样的&lt;a href=&quot;https://github.com/leeight/Baidu-FE-Code-Style#webstorm&quot;&gt;插件&lt;/a&gt;，用起来却也很方便。&lt;/p&gt;
    
    </summary>
    
    
      <category term="JS" scheme="http://xchb.work/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>async-validator使用</title>
    <link href="http://xchb.work/2017/03/02/async-validator%E4%BD%BF%E7%94%A8/"/>
    <id>http://xchb.work/2017/03/02/async-validator使用/</id>
    <published>2017-03-02T12:35:35.000Z</published>
    <updated>2017-03-06T12:48:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>使用<code>antd</code>的<code>Form</code>表单组件时，然后结合文档梳理一下规则使用的几种方式。</p>
<a id="more"></a>
<h1 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Validator = <span class="built_in">require</span>(<span class="string">'async-validator'</span>);</div><div class="line"><span class="keyword">const</span> descriptor = &#123;</div><div class="line">  name: &#123;<span class="keyword">type</span>: <span class="string">"string"</span>, required: <span class="literal">true</span>&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> validator = <span class="keyword">new</span> Validator(descriptor);</div><div class="line"></div><div class="line">validator.validate(&#123;name: <span class="string">"demo"</span>&#125;, <span class="function">(<span class="params">errors, fields</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span>(errors) &#123;</div><div class="line">    <span class="built_in">console</span>.error(errors);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// success</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>基本流程就是，创建一个验证器，参数是需要验证的字段以及其对应的验证规则，然后调用<code>validate</code>开始验证。</p>
<h1 id="规则形式"><a href="#规则形式" class="headerlink" title="规则形式"></a>规则形式</h1><p><code>async-validator</code>中定义的校验规则格式有些会有简写，但通过一系列内部判断转化之后，其规则格式基本可以统一为：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attribute">name</span>: [&#123;<span class="attribute">type</span>: <span class="string">'string'</span>, <span class="attribute">validator</span>: function() &#123;&#125;, <span class="attribute">field</span>: <span class="string">'name'</span>&#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>必需字段包含<code>type</code>, <code>validator</code>两个字段。如果没有<code>validator</code>函数时，验证时会自动跳过。</p>
<h2 id="1-规则是方法"><a href="#1-规则是方法" class="headerlink" title="1. 规则是方法"></a>1. 规则是方法</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> descriptor = &#123;</div><div class="line">    number: <span class="function"><span class="keyword">function</span> <span class="title">custom</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// 提供只一个validate方法</span></div><div class="line">    <span class="comment">// 也可以是</span></div><div class="line">    <span class="comment">// number: [function custom() &#123;&#125;]</span></div><div class="line">    <span class="comment">// 或者</span></div><div class="line">    <span class="comment">// number: &#123;validator: function custom() &#123;&#125;&#125;</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> validator = <span class="keyword">new</span> Validator(descriptor);</div><div class="line"></div><div class="line">....</div></pre></td></tr></table></figure>
<p>这个规则在验证是会被转化为：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attribute">number</span>: [&#123;<span class="attribute">type</span>: <span class="string">'string'</span>, <span class="attribute">validator</span>: function custom() &#123;&#125;, <span class="attribute">field</span>: <span class="string">'number'</span>&#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果规则是方法时，在回调<code>async-validator</code>会注入5个参数 <code>rule, value, callback, source, options</code>:</p>
<ul>
<li><code>rule</code>: 当前验证使用的规则</li>
<li><code>value</code>: 字段的值</li>
<li><code>callback</code>: 验证完成时的回调函数，参数是<code>null 或者 [] 或者 [new Error(&#39;not valid&#39;)]</code></li>
<li><code>source</code>: 验证时的所有数据</li>
<li><code>options</code>: 额外的验证选项，可以包含<code>message</code>来覆盖默认的错误信息</li>
</ul>
<h2 id="2-规则是一个对象"><a href="#2-规则是一个对象" class="headerlink" title="2. 规则是一个对象"></a>2. 规则是一个对象</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> descriptor = &#123;</div><div class="line">  user: &#123;required: <span class="literal">true</span>&#125;  <span class="comment">// user 字段必填</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> validator = <span class="keyword">new</span> Validator(descriptor);</div><div class="line"></div><div class="line">....</div></pre></td></tr></table></figure>
<p>在验证时会被转化成：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="comment">// validators.required 是内部已定义好的检验函数</span></div><div class="line"><span class="symbol">    user:</span> [&#123;<span class="string">type:</span> <span class="string">'string'</span>, <span class="string">required:</span> <span class="literal">true</span>, <span class="string">validator:</span> validators.required, <span class="string">field:</span> <span class="string">'user'</span>&#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="3-规则是一个数组"><a href="#3-规则是一个数组" class="headerlink" title="3. 规则是一个数组"></a>3. 规则是一个数组</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> descriptor = &#123;</div><div class="line">  email: [&#123;required: <span class="literal">true</span>&#125;, &#123;<span class="keyword">type</span>: <span class="string">'email'</span>&#125;]  <span class="comment">// user 字段必填</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> validator = <span class="built_in">new</span> Validator(descriptor);</div><div class="line"></div><div class="line">....</div></pre></td></tr></table></figure>
<h2 id="4-规则包含嵌套"><a href="#4-规则包含嵌套" class="headerlink" title="4. 规则包含嵌套"></a>4. 规则包含嵌套</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="string">const</span> <span class="string">descriptor</span> <span class="string">=</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">    address:</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">      type:</span> <span class="string">'object'</span><span class="string">,</span></div><div class="line"><span class="attr">      required:</span> <span class="literal">true</span><span class="string">,</span></div><div class="line"><span class="attr">      fields:</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">        province:</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">          type:</span> <span class="string">'string'</span><span class="string">,</span></div><div class="line"><span class="attr">          required:</span> <span class="literal">true</span><span class="string">,</span></div><div class="line"><span class="attr">          min:</span> <span class="number">4</span><span class="string">,</span></div><div class="line">        <span class="string">&#125;,</span></div><div class="line"><span class="attr">        city:</span> <span class="string">&#123;</span></div><div class="line"><span class="attr">          type:</span> <span class="string">'string'</span><span class="string">,</span></div><div class="line"><span class="attr">          message:</span> <span class="string">'custom message'</span><span class="string">,</span></div><div class="line"><span class="attr">          min:</span> <span class="number">5</span><span class="string">,</span></div><div class="line">        <span class="string">&#125;</span></div><div class="line">      <span class="string">&#125;</span></div><div class="line">    <span class="string">&#125;</span></div><div class="line"><span class="string">&#125;</span></div><div class="line"><span class="string">const</span> <span class="string">validator</span> <span class="string">=</span> <span class="string">new</span> <span class="string">Validator(descriptor);</span></div></pre></td></tr></table></figure>
<h1 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h1><p><a href="https://github.com/yiminghe/async-validator" target="_blank" rel="external">async-validator</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用&lt;code&gt;antd&lt;/code&gt;的&lt;code&gt;Form&lt;/code&gt;表单组件时，然后结合文档梳理一下规则使用的几种方式。&lt;/p&gt;
    
    </summary>
    
    
      <category term="React" scheme="http://xchb.work/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>ES6之Destructuring</title>
    <link href="http://xchb.work/2017/02/21/ES6%E4%B9%8BDestructuring/"/>
    <id>http://xchb.work/2017/02/21/ES6之Destructuring/</id>
    <published>2017-02-21T03:08:01.000Z</published>
    <updated>2017-02-22T04:51:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>记录不同形式Destructuring导致的不同结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">move1</span>(<span class="params">&#123;x=<span class="number">0</span>, y=<span class="number">0</span>&#125; = &#123;&#125;</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(x, y)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">move2</span>(<span class="params">&#123;x, y&#125; = &#123;x: <span class="number">0</span>, y: <span class="number">0</span>&#125;</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(x, y)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>分别测试以下几种情况：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 测试输入为空</span></div><div class="line"><span class="selector-tag">move1</span>();   <span class="comment">// 0 0</span></div><div class="line"><span class="selector-tag">move2</span>(); <span class="comment">// 0 0</span></div><div class="line"></div><div class="line"><span class="comment">// 测试输入&#123;z: 3&#125;</span></div><div class="line"><span class="selector-tag">move1</span>(&#123;<span class="attribute">z</span>:<span class="number">3</span>&#125;);   <span class="comment">// 0 0</span></div><div class="line"><span class="selector-tag">move2</span>(&#123;<span class="attribute">z</span>:<span class="number">3</span>&#125;); <span class="comment">// undefined undefined</span></div><div class="line"></div><div class="line"><span class="comment">// 测试输入 &#123;x:1, y: 2&#125;</span></div><div class="line"><span class="selector-tag">move1</span>(&#123;<span class="attribute">x</span>:<span class="number">1</span>, <span class="attribute">y</span>:<span class="number">2</span>&#125;)     <span class="comment">// 1, 2</span></div><div class="line"><span class="selector-tag">move2</span>(&#123;<span class="attribute">x</span>:<span class="number">1</span>, <span class="attribute">y</span>:<span class="number">2</span>&#125;)   <span class="comment">// 1, 2</span></div></pre></td></tr></table></figure></p>
<p>对于<code>move1</code>函数：</p>
<ol>
<li>如果输入为空 <code>&#39;&#39;</code>  ==&gt;  <code>{x = 0, y = 0} = {}</code>  ==&gt; <code>x = 0, y = 0</code>;</li>
<li>输入为 <code>{z: 3}]</code>  ==&gt;  <code>{x = 0, y = 0} = {z: 3}</code>  ==&gt; <code>x = 0, y = 0</code>;</li>
<li>输入为 <code>{x:1, y: 2}</code> ==&gt; <code>{x = 0, y = 0} = {x: 1, y: 2}</code> ==&gt; <code>x = 1, y = 2</code>;</li>
</ol>
<p>对于<code>move2</code>函数：</p>
<ol>
<li>如果输入为空 <code>&#39;&#39;</code>  ==&gt;  <code>{x, y} = {x: 0, y: 0}</code>  ==&gt; <code>x = 0, y = 0</code>;</li>
<li>输入为 <code>{z: 3}]</code>  ==&gt;  <code>{x, y} = {z: 3}</code>  ==&gt; <code>x = undefined, y = undefined</code>;</li>
<li>输入为 <code>{x:1, y: 2}</code> ==&gt; <code>{x, y} = {x: 1, y: 2}</code> ==&gt; <code>x = 1, y = 2</code>;</li>
</ol>
<p>主要区别就是有输入时，如果没有同名属性 <code>{x, y} = {x: 0, y: 0}</code>这种写法取不到默认值。</p>
<p>ps. 在ES6中如果解构对象时：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let &#123;<span class="selector-tag">a</span>, ...b&#125; = &#123;<span class="selector-tag">a</span>: <span class="number">1</span>, c: <span class="number">2</span>, d:<span class="number">3</span>&#125;  <span class="comment">// Uncaught SyntaxError: Unexpected token ...</span></div></pre></td></tr></table></figure>
<p>但是在React中使用ES6这种写法却很常见，原因是babel(<a href="http://babeljs.io/repl" target="_blank" rel="external">babel在线编译</a>)增强解构功能，会将这种写法编译为：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">_objectWithoutProperties</span><span class="params">(obj, keys)</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> target = &#123;&#125;;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i in obj) &#123;</div><div class="line">        <span class="keyword">if</span> (keys.indexOf(i) &gt;= <span class="number">0</span>) <span class="keyword">continue</span>;</div><div class="line">        <span class="keyword">if</span> (!Object.prototype.hasOwnProperty.call(obj, i)) <span class="keyword">continue</span>;</div><div class="line">        target[i] = obj[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> target;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> _a$c$d = &#123; a: <span class="number">1</span>, c: <span class="number">2</span>, d: <span class="number">3</span> &#125;,</div><div class="line">    a = _a$c$d.a,</div><div class="line">    b = _objectWithoutProperties(_a$c$d, [<span class="string">"a"</span>]);</div></pre></td></tr></table></figure></p>
<p>扩展阅读：</p>
<ol>
<li><a href="http://exploringjs.com/es6/ch_destructuring.html" target="_blank" rel="external">Exploring ES6 Destructuring</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录不同形式Destructuring导致的不同结果：&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;move1&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&amp;#123;x=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, y=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&amp;#125; = &amp;#123;&amp;#125;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(x, y)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;move2&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&amp;#123;x, y&amp;#125; = &amp;#123;x: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, y: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&amp;#125;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(x, y)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="JS" scheme="http://xchb.work/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>ES6之Temporal Dead Zone</title>
    <link href="http://xchb.work/2017/02/20/ES6%E4%B9%8BTemporal-Dead-Zone/"/>
    <id>http://xchb.work/2017/02/20/ES6之Temporal-Dead-Zone/</id>
    <published>2017-02-20T03:26:08.000Z</published>
    <updated>2017-02-22T04:48:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>在使用ES6时，一般都是推荐使用<code>let, const</code>来定义变量，相对<code>var</code>而言：</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">Hoisting</th>
<th style="text-align:left">Scope</th>
<th style="text-align:left">Creates global properties</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">var</td>
<td style="text-align:left">Declaration</td>
<td style="text-align:left">Function</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:left">let</td>
<td style="text-align:left">Temporal dead zone</td>
<td style="text-align:left">Block</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td style="text-align:left">const</td>
<td style="text-align:left">Temporal dead zone</td>
<td style="text-align:left">Block</td>
<td style="text-align:left">No</td>
</tr>
</tbody>
</table>
<p><code>Temporal dead zone</code>这个与<code>var</code>的<code>Declaration</code>有什么不一样的地方？</p>
<a id="more"></a>
<p>先看一个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// var定义的变量提升</span></div><div class="line"><span class="built_in">console</span>.log(tmpVar); <span class="comment">// undefined</span></div><div class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</div><div class="line">    <span class="keyword">var</span> tmpVar = <span class="number">12</span>; <span class="comment">// var定义的变量不是块级作用域</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(tmpVar); <span class="comment">// 12</span></div><div class="line"></div><div class="line"><span class="comment">// let定义的变量提升</span></div><div class="line"><span class="keyword">let</span> tmp = <span class="literal">true</span>;</div><div class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123; <span class="comment">// 新的作用域 TDZ 开始</span></div><div class="line">    <span class="built_in">console</span>.log(tmp);  <span class="comment">// ReferenceError</span></div><div class="line"></div><div class="line">    <span class="keyword">let</span> tmp; <span class="comment">// TDZ 结束, `tmp` 被初始化为 undefined</span></div><div class="line">    <span class="built_in">console</span>.log(tmp); <span class="comment">// undefined</span></div><div class="line"></div><div class="line">    tmp = <span class="number">123</span>;</div><div class="line">    <span class="built_in">console</span>.log(tmp); <span class="comment">// 123</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(tmp); <span class="comment">// true</span></div></pre></td></tr></table></figure></p>
<p>可以查看其实<code>TDZ</code>类似于一个视觉的盲区，在作用域中应该意识到变量的存在，但却看不见，更用不了。</p>
<p>之所以需要<code>TDZ</code>：</p>
<ol>
<li>捕获错误： 变量提升本就比较奇怪，也不太符合变量需要定义才能使用的逻辑。</li>
<li><code>const</code>语义要求： <code>const</code>定义一个不可以变更的常量，只能在定义时赋值，如果存在变量提升和语义不符合。为了保持一致，所以<code>let</code>也有<code>TDZ</code>。</li>
</ol>
<h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ol>
<li><a href="http://exploringjs.com/es6/ch_variables.html" target="_blank" rel="external">9.4 The temporal dead zone</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在使用ES6时，一般都是推荐使用&lt;code&gt;let, const&lt;/code&gt;来定义变量，相对&lt;code&gt;var&lt;/code&gt;而言：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;Hoisting&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;Scope&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;Creates global properties&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;var&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Declaration&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Function&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Yes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;let&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Temporal dead zone&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Block&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;No&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;const&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Temporal dead zone&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Block&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;No&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;Temporal dead zone&lt;/code&gt;这个与&lt;code&gt;var&lt;/code&gt;的&lt;code&gt;Declaration&lt;/code&gt;有什么不一样的地方？&lt;/p&gt;
    
    </summary>
    
    
      <category term="JS" scheme="http://xchb.work/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>TCP三步握手</title>
    <link href="http://xchb.work/2017/02/06/TCP%E4%B8%89%E6%AD%A5%E6%8F%A1%E6%89%8B/"/>
    <id>http://xchb.work/2017/02/06/TCP三步握手/</id>
    <published>2017-02-06T02:58:35.000Z</published>
    <updated>2017-02-06T13:55:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>探索问题：</p>
<ol>
<li>TCP建立连接为什么要三步握手</li>
<li>建立连接时发送的SEQ, ACK是什么</li>
</ol>
<a id="more"></a>
<h1 id="三步握手"><a href="#三步握手" class="headerlink" title="三步握手"></a>三步握手</h1><p>握手主要原因：在不可靠的网络之上提供可靠的服务。</p>
<p>在Andrew S.Tanenbaum的经典书籍《计算机网络》第5版的「6.2.2 连接建立」小节有很详细的说明：</p>
<p>首先，因为网络有可能会出现延迟或者重复数据包的时候，所以在连接的建立时，每个数据包都会有一个序号，以解决如何区分重复数据包的问题。</p>
<p>然而，这样还是会有问题，《计算机网络》中说的是『数据包的接受者通常不会去保存连接的序号，所以无法区分CONNECTION REQUEST中的初始序号是否和当前连接的序号重复。』我对这句话的理解：</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">HOST1</span>                      <span class="comment">HOST2</span></div><div class="line"></div><div class="line">  <span class="comment">|</span> <span class="literal">-</span><span class="literal">-</span><span class="literal">-</span> <span class="comment">SYN(SEQ=x)</span>          <span class="literal">-</span><span class="literal">-</span>&gt; <span class="comment">|</span>       </div><div class="line"></div><div class="line">  <span class="comment">|</span> &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">SYN(SEQ=Y)</span>          <span class="literal">-</span><span class="literal">-</span><span class="literal">-</span> <span class="comment">|</span></div><div class="line"></div><div class="line">  <span class="comment">|</span> <span class="literal">-</span><span class="literal">-</span><span class="literal">-</span> <span class="comment">SYN(SEQ=x</span><span class="string">,</span> <span class="comment">ACK=y</span><span class="literal">+</span><span class="comment">1)</span> <span class="literal">-</span><span class="literal">-</span>&gt; <span class="comment">|</span></div><div class="line"></div><div class="line">  <span class="comment">|</span> &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">SYN(SEQ=y</span><span class="string">,</span> <span class="comment">ACK=x</span><span class="literal">+</span><span class="comment">1)</span> <span class="literal">-</span><span class="literal">-</span><span class="literal">-</span> <span class="comment">|</span></div></pre></td></tr></table></figure>
<p>此时建立的连接应该是一个，而不是两个，因为所有的连接都是有它们的端点（由TCP的端口加上所在主机的IP地址组成「6.5.4 TCP端的头」小节有介绍）来标识的。第一个请求产生了一个由（x,y）标识的连接，而第二个请求也建立一个这样的连接，实际上只有一个表项，即(x,y)。</p>
<p>针对上述问题，引入了三步握手协议。这个协议要求在建立连接时，一方需要和另一方确认连接请求是否是当前的。即 A -SYN(SEQ=x)-&gt; B; B -SYN(SEQ=y, ACK=x+1)-&gt;A; A -DATA(SEQ=x+1,ACK=y+1)-&gt; B。</p>
<p>当然三步握手也不是绝对可靠，因为请求只能保证之前的传输是可靠，但不能预测接下来的也正确，在知乎上看到一个回答可以参考<a href="https://www.zhihu.com/question/24853633" target="_blank" rel="external">TCP 为什么是三次握手，为什么不是两次或四次？</a>, 为了方便阅读，引用至此：</p>
<blockquote>
<p>这个问题的本质是, 信道不可靠, 但是通信双发需要就某个问题达成一致. 而要解决这个问题,  无论你在消息中包含什么信息, 三次通信是理论上的最小值. 所以三次握手不是TCP本身的要求, 而是为了满足”在不可靠信道上可靠地传输信息”这一需求所导致的. 请注意这里的本质需求,信道不可靠, 数据传输要可靠. 三次达到了, 那后面你想接着握手也好, 发数据也好, 跟进行可靠信息传输的需求就没关系了. 因此,如果信道是可靠的, 即无论什么时候发出消息, 对方一定能收到, 或者你不关心是否要保证对方收到你的消息, 那就能像UDP那样直接发送消息就可以了.”</p>
</blockquote>
<h1 id="字段说明"><a href="#字段说明" class="headerlink" title="字段说明"></a>字段说明</h1><ol>
<li><p>SEQ，初始序号。在一个时间周期T（互联网比较随意的定为120s，看具体实现）内，这个序号应该是唯一的。</p>
</li>
<li><p>ACK, SEQ+1. 表示确认序号SEQ的请求，TCP确认数据包的机制。</p>
</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li>《计算机网络》 by Andrew S.Tanenbaum</li>
<li><a href="https://www.zhihu.com/question/24853633" target="_blank" rel="external">TCP 为什么是三次握手，为什么不是两次或四次？</a></li>
<li><a href="http://blog.csdn.net/wjtxt/article/details/6606022" target="_blank" rel="external">TCP报文到达确认（ACK）机制</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;探索问题：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;TCP建立连接为什么要三步握手&lt;/li&gt;
&lt;li&gt;建立连接时发送的SEQ, ACK是什么&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Socket.io问题分析</title>
    <link href="http://xchb.work/2017/02/03/Socket-io%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/"/>
    <id>http://xchb.work/2017/02/03/Socket-io问题分析/</id>
    <published>2017-02-03T07:59:57.000Z</published>
    <updated>2017-02-03T08:21:17.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="广播数据"><a href="#广播数据" class="headerlink" title="广播数据"></a>广播数据</h2><p>如何向所有的客户端广播数据？</p>
<ol>
<li><p>使用io.sockets.emit</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"></div><div class="line"><span class="keyword">var</span> io = <span class="keyword">require</span>(<span class="string">'socket.io'</span>)(server);</div><div class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span><span class="params">(socket)</span></span>&#123;</div><div class="line">    io.sockets.emit(<span class="string">'new'</span>, &#123;hello: <span class="string">'world'</span>&#125;);      </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>使用socket.broadcast.emit</p>
</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"></div><div class="line"><span class="keyword">var</span> io = <span class="keyword">require</span>(<span class="string">'socket.io'</span>)(server);</div><div class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span><span class="params">(socket)</span></span>&#123;</div><div class="line">    socket.broadcast.emit(<span class="string">'new'</span>, &#123;hello: <span class="string">'world'</span>&#125;);      </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>两种方式区别<code>io.sockets.emit</code>向所有连接的客户端广播数据，而<code>socket.broadcast.emit</code>则向<br>除了该<code>socket</code>自身之外的其他所有广播数据。其实也就是说<br><code>io.sockets.emit</code> = <code>socket.broadcast.emit</code> + <code>socket.emit</code></p>
<p>因此可以猜测出socket.io内部会保留所有连接的socket。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;广播数据&quot;&gt;&lt;a href=&quot;#广播数据&quot; class=&quot;headerlink&quot; title=&quot;广播数据&quot;&gt;&lt;/a&gt;广播数据&lt;/h2&gt;&lt;p&gt;如何向所有的客户端广播数据？&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;使用io.sockets.emit&lt;/p&gt;
&lt;figure c
    
    </summary>
    
    
      <category term="JS" scheme="http://xchb.work/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>nodejs mongodb</title>
    <link href="http://xchb.work/2016/11/29/nodejs-mongodb/"/>
    <id>http://xchb.work/2016/11/29/nodejs-mongodb/</id>
    <published>2016-11-29T12:01:09.000Z</published>
    <updated>2016-11-29T12:20:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>记录一下nodejs配置mongodb的过程：</p>
<ol>
<li><p>mac上安装mongodb:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">brew </span><span class="keyword">install </span>mongodb</div></pre></td></tr></table></figure>
</li>
<li><p>创建一个存在数据目录</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">mkdir</span> -p ~/<span class="class"><span class="keyword">data</span>/db</span></div></pre></td></tr></table></figure>
</li>
<li><p>在用户根目录运行mongodb，指定数据存在路径为刚刚新建的目录</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod <span class="comment">--dbpath=./data/db</span></div></pre></td></tr></table></figure>
<a id="more"></a>
</li>
<li><p>安装nodejs驱动程序mongodb和mongoose</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> mongoose mongodb</div></pre></td></tr></table></figure>
</li>
<li><p>连接mongodb：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">const mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">'mongodb://localhost/todo'</span>);</div><div class="line"></div><div class="line">mongoose.connection.<span class="literal">on</span>(<span class="string">'error'</span>, err =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.error(err);</div><div class="line">&#125;).<span class="literal">on</span>(<span class="string">'open'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'connected'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>其他：</p>
<p>mongodb可视化软件：<a href="https://mongobooster.com/" target="_blank" rel="external">mongobooster</a> 没有找到破解版，而且价格略贵</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录一下nodejs配置mongodb的过程：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;mac上安装mongodb:&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;brew &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;install &lt;/span&gt;mongodb&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;创建一个存在数据目录&lt;/p&gt;
&lt;figure class=&quot;highlight haskell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;title&quot;&gt;mkdir&lt;/span&gt; -p ~/&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;data&lt;/span&gt;/db&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在用户根目录运行mongodb，指定数据存在路径为刚刚新建的目录&lt;/p&gt;
&lt;figure class=&quot;highlight ada&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mongod &lt;span class=&quot;comment&quot;&gt;--dbpath=./data/db&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="nodejs" scheme="http://xchb.work/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>网页代理</title>
    <link href="http://xchb.work/2016/11/10/%E7%BD%91%E9%A1%B5%E4%BB%A3%E7%90%86/"/>
    <id>http://xchb.work/2016/11/10/网页代理/</id>
    <published>2016-11-10T01:54:04.000Z</published>
    <updated>2016-11-11T13:37:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>前端开发时，经常需要用代理工具Charles或者Fiddler来抓包，或修改接口或替换文件或查看提交数据等，都是非常方便。尤其是做移动端开发时，是不是经常得配置host，或者查看页面请求的数据是否正确，相信我，此时使用Charles的远程代理是一件很幸福的事情。</p>
<p>当我们打开浏览器请求一个页面时候，为什么Charles就能捕获到请求？然而如果chrome使用了<code>SwitchyOmega（配合shadowsocks，翻墙神器）</code>或者类似的代理插件，此时Charles时捕获不到我们发的请求。</p>
<a id="more"></a>
<p>一开始我也很困惑，直到有一次Charles崩溃了，使用装有<code>SwitchyOmega</code>插件的chrome浏览器可以正常联网，而其他浏览器却不行了。在查看网络设置（网络-&gt;代理）中，一不小发现：</p>
<p><img src="/img/proxy/network.png" alt="代理设置"></p>
<p>我明明没有设置过这个东西啊，看着<code>8888</code>这个端口号好熟悉啊，额，这个不就是Charles代理设置里面默认的端口号嘛。于是好像突然明白了，Charles是通过这个来监听网页请求，然后抓包，然后就可以对请求进行修改请求参数，断点调试等。</p>
<p>然后再次正常打开Charles，然后正常关闭，果然网页代理设置没有，非chrome浏览器也可以正常联网了。如果打开Charles，手动把代理设置取消，Charles也捕获不了请求了。</p>
<p>既然Charles可以通过设置网络代理来捕获请求，那是否可以自己写一个服务器也实现同样的功能呢？</p>
<p>首先创建一个简单的node服务器：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">const http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="params">(req, res)</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(req.url);</div><div class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</div><div class="line">    res.end(<span class="string">'it work'</span>);</div><div class="line">&#125;).listen(<span class="number">1338</span>, <span class="string">'127.0.0.1'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'server start at 127.0.0.1:1338'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>然后启动服务器，顺便设置网络的网页代理为服务器的地址<code>127.0.0.1:1338</code>;接下来访问一个http地址(<a href="http://www.csdn.net/" target="_blank" rel="external">csdn</a>)，因为设置网页代理，当然也可以设置安全网页代理。页面如期待的那样出现了<code>it work</code>。</p>
<p>代理服务器已经搭建好，但怎么像Charles一样能正常返回请求的页面？</p>
<p>万事开头难，开头了，其实后面确实也就简单了很多。有疑问，但知道具体想做什么，百度一下，不就什么都知道了嘛。参考<a href="https://imququ.com/post/web-proxy.html" target="_blank" rel="external">HTTP 代理原理及实现（一）</a>修改一下源码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</div><div class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(req.url);</div><div class="line">    <span class="keyword">const</span> u = url.parse(req.url);</div><div class="line">    <span class="keyword">var</span> options = &#123;</div><div class="line">        <span class="attr">hostname</span> : u.hostname,</div><div class="line">        <span class="attr">port</span>     : u.port || <span class="number">80</span>,</div><div class="line">        <span class="attr">path</span>     : u.path,</div><div class="line">        <span class="attr">method</span>   : req.method,</div><div class="line">        <span class="attr">headers</span>  : req.headers</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> pReq = http.request(options, <span class="function"><span class="keyword">function</span>(<span class="params">pRes</span>) </span>&#123;</div><div class="line">        res.writeHead(pRes.statusCode, pRes.headers);</div><div class="line">        pRes.pipe(res);</div><div class="line">    &#125;).on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">        res.end();</div><div class="line">    &#125;);</div><div class="line">    req.pipe(pReq);</div><div class="line">&#125;).listen(<span class="number">1338</span>, <span class="string">'127.0.0.1'</span>, () =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'server start at 127.0.0.1:1338'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>顺利完成http代理，不信你再访问<a href="http://www.csdn.net/" target="_blank" rel="external">csdn</a>试试，没有出现页面就是csdn挂了。至于https的可以参考<a href="https://imququ.com/post/web-proxy.html" target="_blank" rel="external">HTTP 代理原理及实现（一）</a>里面有详细的介绍Http代理相关的知识。</p>
<p>嗯嗯，http代理完成了，但是还有个问题啊，为什么上面通过解析<code>req.url</code>就能获取请求的目标地址，而自己想写一个脚本访问CSDN：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">    <span class="attr">host</span>: <span class="string">"localhost"</span>,</div><div class="line">    <span class="attr">port</span>: <span class="number">1338</span>,</div><div class="line">    <span class="attr">method</span>: <span class="string">'GET'</span></div><div class="line">&#125;;</div><div class="line">http.request(options, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</div><div class="line">    res.pipe(process.stdout);</div><div class="line">&#125;).end();</div></pre></td></tr></table></figure></p>
<p>遍观<a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_http_get_options_callback" target="_blank" rel="external">nodejs官网http.request</a>的可选参数, 都没有提到如何设置。不知道又想不明白，能咋办，上网找呗。</p>
<p>在stackoverflow上找到了一个解决方案，<a href="http://stackoverflow.com/questions/3862813/how-can-i-use-an-http-proxy-with-node-js-http-client" target="_blank" rel="external">传送–&gt;How can I use an http proxy with node.js http.Client</a>给的方案是设置<code>path</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">    <span class="attr">host</span>: <span class="string">"localhost"</span>,</div><div class="line">    <span class="attr">port</span>: <span class="number">1338</span>,</div><div class="line">    <span class="attr">method</span>: <span class="string">'GET'</span>,</div><div class="line">    <span class="attr">path</span>: <span class="string">"http://www.csdn.net"</span>,</div><div class="line">    <span class="attr">headers</span>: &#123;</div><div class="line">       <span class="attr">Host</span>: <span class="string">"www.csdn.net"</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">http.request(options, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</div><div class="line">    res.pipe(process.stdout);</div><div class="line">&#125;).end();</div></pre></td></tr></table></figure></p>
<p>仔细想像好像真的是这么回事啊，如果不设置<code>path</code>,服务器默端的<code>req.url</code>就是个<code>/</code>，这个不就是默认的<code>path</code>的值嘛。至于设置<code>headers</code>里面的<code>Host</code>, 如果不设置会默认为<code>localhost:1338</code>，也就是请求的服务器的host，这样获得的是一个403页面，如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>403 Forbidden<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">bgcolor</span>=<span class="string">"white"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>403 Forbidden<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>nginx<span class="tag">&lt;/<span class="name">center</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>参考：</p>
<ol>
<li><a href="https://imququ.com/post/web-proxy.html" target="_blank" rel="external">HTTP 代理原理及实现（一）</a></li>
<li><a href="http://stackoverflow.com/questions/3862813/how-can-i-use-an-http-proxy-with-node-js-http-client" target="_blank" rel="external">How can I use an http proxy with node.js http.Client</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前端开发时，经常需要用代理工具Charles或者Fiddler来抓包，或修改接口或替换文件或查看提交数据等，都是非常方便。尤其是做移动端开发时，是不是经常得配置host，或者查看页面请求的数据是否正确，相信我，此时使用Charles的远程代理是一件很幸福的事情。&lt;/p&gt;
&lt;p&gt;当我们打开浏览器请求一个页面时候，为什么Charles就能捕获到请求？然而如果chrome使用了&lt;code&gt;SwitchyOmega（配合shadowsocks，翻墙神器）&lt;/code&gt;或者类似的代理插件，此时Charles时捕获不到我们发的请求。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>nodejs使用shebang</title>
    <link href="http://xchb.work/2016/09/30/nodejs%E4%BD%BF%E7%94%A8shebang/"/>
    <id>http://xchb.work/2016/09/30/nodejs使用shebang/</id>
    <published>2016-09-30T02:19:20.000Z</published>
    <updated>2016-09-30T03:06:33.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="基本含义"><a href="#基本含义" class="headerlink" title="基本含义"></a>基本含义</h1><p><code>shebang</code>也可以称之为<code>hashbang</code>, 代指<code>#!</code>。一般出现在脚本的第一行，用于在unix系统或类unix系统中指定默认的脚本文件的解释程序。<br>其语法格式是：</p>
<blockquote>
<p>#!interpreter [optional-arg] // 解释程序的绝对路径和可选参数</p>
</blockquote>
<ol>
<li>如果脚本文件中没有<code>#!</code>这一行，执行时会以系统默认的解释程序允许</li>
<li>如果<code>#!</code>之后的解释程序是一个可执行文件，那么执行这个脚本时，它就会把文件名及其参数一起作为参数传给那个解释程序去执行。</li>
</ol>
<a id="more"></a>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><p>在我的电脑中通过<code>nvm</code>安装了两个node版本。一个是4.4.5版本，一个是6.2.0版本。</p>
<ol>
<li><p>新建一个脚本文件–<code>testShebang</code>，通过<code>shebang</code>指定其默认node版本为4.4.5</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#! /Users/baidu/.nvm/versions/node/v4.4.5/bin/node</span></div><div class="line"><span class="comment">// 打印node的版本</span></div><div class="line">console.log(process.<span class="keyword">version</span>)</div></pre></td></tr></table></figure>
</li>
<li><p>给<code>testShebang</code>添加可执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ chmod 755 <span class="built_in">test</span>Shebang</div></pre></td></tr></table></figure>
</li>
<li><p>切换终端的node版本为6.2.0。</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">node</span> <span class="title">-v</span></div><div class="line">v6.<span class="number">2.0</span></div></pre></td></tr></table></figure>
</li>
<li><p>指定node执行该文件</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">node</span> <span class="title">testShebang</span></div><div class="line">v6.<span class="number">2.0</span></div></pre></td></tr></table></figure>
</li>
<li><p>直接执行</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ./testShebang</div><div class="line">v4<span class="number">.4</span><span class="number">.5</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://en.wikipedia.org/wiki/Shebang_(Unix" target="_blank" rel="external">wikipedia: Shebang (Unix)</a>)</li>
<li><a href="https://linux.cn/article-3664-1.html" target="_blank" rel="external">释伴：Linux 上的 Shebang 符号(#!)</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;基本含义&quot;&gt;&lt;a href=&quot;#基本含义&quot; class=&quot;headerlink&quot; title=&quot;基本含义&quot;&gt;&lt;/a&gt;基本含义&lt;/h1&gt;&lt;p&gt;&lt;code&gt;shebang&lt;/code&gt;也可以称之为&lt;code&gt;hashbang&lt;/code&gt;, 代指&lt;code&gt;#!&lt;/code&gt;。一般出现在脚本的第一行，用于在unix系统或类unix系统中指定默认的脚本文件的解释程序。&lt;br&gt;其语法格式是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;#!interpreter [optional-arg] // 解释程序的绝对路径和可选参数&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;如果脚本文件中没有&lt;code&gt;#!&lt;/code&gt;这一行，执行时会以系统默认的解释程序允许&lt;/li&gt;
&lt;li&gt;如果&lt;code&gt;#!&lt;/code&gt;之后的解释程序是一个可执行文件，那么执行这个脚本时，它就会把文件名及其参数一起作为参数传给那个解释程序去执行。&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="nodejs" scheme="http://xchb.work/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>Angular 小技巧</title>
    <link href="http://xchb.work/2016/09/27/Angular-%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    <id>http://xchb.work/2016/09/27/Angular-小技巧/</id>
    <published>2016-09-27T01:35:35.000Z</published>
    <updated>2017-02-22T04:55:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-textarea的placeholder换行"><a href="#1-textarea的placeholder换行" class="headerlink" title="1.textarea的placeholder换行"></a>1.<code>textarea</code>的<code>placeholder</code>换行</h1><p>问题：placeholder中的文本过长，或者需要格式化展示文本时，需要使用多行展示。<br>解决方案：使用angular中的数据绑定就可以轻松实现<br><figure class="highlight django"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">"6"</span> <span class="attr">cols</span>=<span class="string">"45"</span> <span class="attr">placeholder</span>=<span class="string">"</span></span></span><span class="template-variable">&#123;&#123;'第一行\n第二行\n第三行\n第四行'&#125;&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></div></pre></td></tr></table></figure></p>
<p>解决方案来源：<a href="http://stackoverflow.com/a/38128759" target="_blank" rel="external">Can you have multiline HTML5 placeholder text in a textarea?</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1-textarea的placeholder换行&quot;&gt;&lt;a href=&quot;#1-textarea的placeholder换行&quot; class=&quot;headerlink&quot; title=&quot;1.textarea的placeholder换行&quot;&gt;&lt;/a&gt;1.&lt;code&gt;textar
    
    </summary>
    
    
      <category term="Angular" scheme="http://xchb.work/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>angular项目中使用iframe相关问题</title>
    <link href="http://xchb.work/2016/09/22/angular%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8iframe%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/"/>
    <id>http://xchb.work/2016/09/22/angular项目中使用iframe相关问题/</id>
    <published>2016-09-22T09:30:34.000Z</published>
    <updated>2016-09-22T09:38:08.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="iframe高度自适应"><a href="#iframe高度自适应" class="headerlink" title="iframe高度自适应"></a>iframe高度自适应</h1><p>问题： 在angular项目中需要嵌入第三方页面，通过iframe来实现，但是嵌入的页面高度未知。</p>
<p>解决方案：自定义一个angular指令，监听iframe的<code>onload</code>事件来获取iframe中内容的高度。</p>
<a id="more"></a>
<p>源码：</p>
<p>angular 代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义指令</span></div><div class="line">App.directive(<span class="string">'iframeOnload'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        scope: &#123;</div><div class="line">            callBack: <span class="string">'&amp;iframeOnload'</span></div><div class="line">        &#125;,</div><div class="line">        link: <span class="function"><span class="keyword">function</span><span class="params">(scope, element, attrs)</span></span>&#123;</div><div class="line">            element.on(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</div><div class="line">                <span class="comment">// 关键是这个</span></div><div class="line">                element.height(element.contents().outerHeight());</div><div class="line">                <span class="keyword">return</span> scope.callBack();</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;&#125;]);</div><div class="line"></div><div class="line"></div><div class="line">App.controller(<span class="string">'MyController'</span>, [<span class="string">'$scope'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope)</span></span>&#123;</div><div class="line"></div><div class="line">    $scope.iframeLoadedCallBack = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="comment">// do stuff</span></div><div class="line">    &#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure></p>
<p>在DOM中使用<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"MyController"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">iframe-onload</span>=<span class="string">"iframeLoadedCallBack()"</span> <span class="attr">src</span>=<span class="string">"..."</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><a href="http://stackoverflow.com/questions/15882326/angular-onload-function-on-an-iframe" target="_blank" rel="external">解决方案来源：Angular, onLoad function on an iFrame</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;iframe高度自适应&quot;&gt;&lt;a href=&quot;#iframe高度自适应&quot; class=&quot;headerlink&quot; title=&quot;iframe高度自适应&quot;&gt;&lt;/a&gt;iframe高度自适应&lt;/h1&gt;&lt;p&gt;问题： 在angular项目中需要嵌入第三方页面，通过iframe来实现，但是嵌入的页面高度未知。&lt;/p&gt;
&lt;p&gt;解决方案：自定义一个angular指令，监听iframe的&lt;code&gt;onload&lt;/code&gt;事件来获取iframe中内容的高度。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Angular" scheme="http://xchb.work/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>nodejs web应用代码热更新</title>
    <link href="http://xchb.work/2016/09/01/nodejs-web%E5%BA%94%E7%94%A8%E4%BB%A3%E7%A0%81%E7%83%AD%E6%9B%B4%E6%96%B0/"/>
    <id>http://xchb.work/2016/09/01/nodejs-web应用代码热更新/</id>
    <published>2016-09-01T09:23:08.000Z</published>
    <updated>2016-09-01T09:25:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>在用nodejs开发web程序过程中, 每次修改都需要重新启动一下服务, 虽然有pm2,forever等解决方案。<br>在fex上看见一个比较另类的解决方案——<a href="http://fex.baidu.com/blog/2015/05/nodejs-hot-swapping/" target="_blank" rel="external">Node.js Web应用代码热更新的另类思路</a></p>
<p>在这里简单实现一下来解决开发过程中热启动的问题。</p>
<p>首先需要重新包装一下nodejs提供的<code>require</code>方法。在require自己写的代码时,同时需要监听文件变化,当文件发生变化时,重新加载模块。</p>
<a id="more"></a>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// wrapperRequire.js</span></div><div class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">cleanCache</span>(<span class="params">modulePath</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = <span class="built_in">require</span>.cache[modulePath];</div><div class="line">    <span class="comment">// remove reference in module.parent</span></div><div class="line">    <span class="keyword">if</span> (<span class="built_in">module</span>.parent) &#123;</div><div class="line">        <span class="built_in">module</span>.parent.children.splice(<span class="built_in">module</span>.parent.children.indexOf(<span class="built_in">module</span>), <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">require</span>.cache[modulePath] = <span class="literal">null</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">watchFile</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> absModulePath = <span class="built_in">require</span>.resolve(obj.modulePath);</div><div class="line">    chokidar.watch(absModulePath).on(<span class="string">'all'</span>, (event, path) =&gt; &#123;</div><div class="line">        cleanCache(absModulePath);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">`file [<span class="subst">$&#123;path&#125;</span>] --&gt; [<span class="subst">$&#123;event&#125;</span>]`</span>);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            obj.name = <span class="built_in">require</span>(obj.modulePath);</div><div class="line">        &#125; <span class="keyword">catch</span> (ex) &#123;</div><div class="line">            <span class="built_in">console</span>.error(<span class="string">'module update failed'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</div><div class="line">    !obj.ignore &amp;&amp; watchFile(obj);</div><div class="line">    obj.name = <span class="built_in">require</span>(obj.modulePath);</div><div class="line">    <span class="keyword">return</span> obj;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>由于使用node原生的fs.watch会出现文件变化监听不到的情况（其他一些问题见<a href="https://github.com/paulmillr/chokidar" target="_blank" rel="external">chokidar readme</a>）,<br>所以这里使用<code>chokidar</code>来实现对文件的监听。</p>
<p>使用<code>wrapperRequire.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// main.js</span></div><div class="line"><span class="keyword">const</span> wrapperRequire = <span class="built_in">require</span>(<span class="string">'./require'</span>);</div><div class="line"><span class="keyword">let</span> code = wrapperRequire(&#123;<span class="attr">modulePath</span>: <span class="string">'./code'</span>, <span class="string">'name'</span>: <span class="string">''</span>&#125;);</div><div class="line">setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(code.name);</div><div class="line">&#125;, <span class="number">1000</span>);</div></pre></td></tr></table></figure></p>
<p>测试文件 <code>code.js</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = <span class="string">'hello world'</span>;</div></pre></td></tr></table></figure></p>
<p>执行<code>main.js</code>然后更改<code>code.js</code>后也可以展示正确的结果。</p>
<p>总结一下,以上实现的基础是:</p>
<ol>
<li>nodejs可以对require缓存的文件进行清空</li>
<li>监听文件变化,然后重新require文件</li>
<li>js函数中传递的Object参数是引用传递</li>
</ol>
<p>参考:<br>1.<a href="http://fex.baidu.com/blog/2015/05/nodejs-hot-swapping/" target="_blank" rel="external">Node.js Web应用代码热更新的另类思路</a><br>2.<a href="https://github.com/paulmillr/chokidar" target="_blank" rel="external">chokidar</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在用nodejs开发web程序过程中, 每次修改都需要重新启动一下服务, 虽然有pm2,forever等解决方案。&lt;br&gt;在fex上看见一个比较另类的解决方案——&lt;a href=&quot;http://fex.baidu.com/blog/2015/05/nodejs-hot-swapping/&quot;&gt;Node.js Web应用代码热更新的另类思路&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在这里简单实现一下来解决开发过程中热启动的问题。&lt;/p&gt;
&lt;p&gt;首先需要重新包装一下nodejs提供的&lt;code&gt;require&lt;/code&gt;方法。在require自己写的代码时,同时需要监听文件变化,当文件发生变化时,重新加载模块。&lt;/p&gt;
    
    </summary>
    
    
      <category term="nodejs" scheme="http://xchb.work/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>event那些事</title>
    <link href="http://xchb.work/2016/07/25/event%E9%82%A3%E4%BA%9B%E4%BA%8B/"/>
    <id>http://xchb.work/2016/07/25/event那些事/</id>
    <published>2016-07-25T11:58:42.000Z</published>
    <updated>2017-02-27T13:07:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>遇到一个问题：</p>
<p><code>A</code>标签跳转前需要做一下登录判断，如果未登录则不让跳转，使用preventDefault发现阻止不了<code>A</code>标签的跳转。</p>
<p>解决方法：</p>
<p>加上stopImmediatePropagation才行。当然也可以把<code>A</code>标签的<code>href</code>属性设置为空，通过js来控制跳转，但改动略大些，忽视。</p>
<p>于是正好借此机会整理和收集一下JavaScript中的event事件。</p>
<a id="more"></a>
<h2 id="事件监听方式"><a href="#事件监听方式" class="headerlink" title="事件监听方式"></a>事件监听方式</h2><p>js中实现事件监听方式，以<code>click</code>事件为例，可以有直接设置元素的<code>onclick</code>属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 直接设置元素的onclick属性 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn1"</span>&gt;</span>js绑定事件测试按钮1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">document</span>.querySelector(<span class="string">'#btn1'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        alert(<span class="string">'js绑定事件方式1'</span>);</div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>或者用<code>addEventListener</code>监听<code>click</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 用addEventListener监听click --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn2"</span>&gt;</span>js绑定事件测试按钮1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">document</span>.querySelector(<span class="string">'#btn2'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">        alert(<span class="string">'js绑定事件方式2'</span>);</div><div class="line">    &#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>提到事件绑定，解绑事件也事件当然也可以有，具体请可以查看<a href="/event.html">Demo</a>。至于像<code>attachEvent</code>这类，这里不多讨论。</p>
<p>比较推荐的绑定方式是<code>addEventListener</code>, 这种方式可以给DOM元素添加不止一个事件处理函数，而且可以控制事件在捕获或冒泡阶段触发。</p>
<p>PS：addEventListener可以接受三个参数，其语法是<code>target.addEventListener(type, listener[, useCapture]);</code>，第三个参数标识是在捕获阶段触发还是在冒泡阶段，默认值为<code>false</code>标识在冒泡阶段触发</p>
<h2 id="事件捕获或冒泡"><a href="#事件捕获或冒泡" class="headerlink" title="事件捕获或冒泡"></a>事件捕获或冒泡</h2><p>这里简要说明一下W3C的事件模型：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">                 |<span class="string"> </span>|<span class="string">  / \</span></div><div class="line">-----------------|<span class="string"> </span>|<span class="string">--</span>|<span class="string"> </span>|<span class="string">-----------------</span></div><div class="line">|<span class="string"> element1       </span>|<span class="string"> </span>|<span class="string">  </span>|<span class="string"> </span>|<span class="string">                </span>|</div><div class="line">|<span class="string">   -------------</span>|<span class="string"> </span>|<span class="string">--</span>|<span class="string"> </span>|<span class="string">-----------     </span>|</div><div class="line">|<span class="string">   </span>|<span class="string">element2    \ /  </span>|<span class="string"> </span>|<span class="string">          </span>|<span class="string">     </span>|</div><div class="line">|<span class="string">   --------------------------------     </span>|</div><div class="line">|<span class="string">        W3C event model                 </span>|</div><div class="line">------------------------------------------</div></pre></td></tr></table></figure></p>
<p>假设给元素添加一下事件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">element1.addEventListener(<span class="string">'click'</span>,<span class="keyword">do</span>Something2,<span class="literal">true</span>)</div><div class="line">element2.addEventListener(<span class="string">'click'</span>,<span class="keyword">do</span>Something,<span class="literal">false</span>)</div></pre></td></tr></table></figure></p>
<p>当点击element2时，首先会点击事件开始于捕获阶段，触发element1的事件处理函数doSomething2，然后捕获阶段没有可执行的的事件处理函数了，接着开始进入冒泡阶段，触发element2的事件处理函数doSomething。</p>
<p>其他一些情况请参考<a href="http://www.quirksmode.org/js/events_order.html" target="_blank" rel="external">Event order</a></p>
<h2 id="事件阻止"><a href="#事件阻止" class="headerlink" title="事件阻止"></a>事件阻止</h2><p>事件阻止有三个方法： preventDefault，stopPropagation，stopImmediatePropagation。</p>
<ol>
<li>preventDefault： 阻止DOM元素的默认行为，例如阻止表单<code>type=&quot;submit&quot;</code>的button或input的提交表单行为。</li>
<li>stopPropagation： 阻止事件的传播（冒泡）。</li>
<li>stopImmediatePropagation： 阻止其他事件处理函数执行，并也会阻止事件的传播。</li>
<li>事件处理函数中使用 <code>return false</code>：效果等价于 preventDefault + stopPropagation (据说是jQuery中实现的，原生JS中并没有什么用，测试环境是chrome 52)。</li>
</ol>
<p>具体请查看<a href="/event.html">Demo</a></p>
<p>PS: 重点不是本文所写，而是以下参考的文章。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" target="_blank" rel="external">EventTarget.addEventListener</a></li>
<li><a href="https://codeplanet.io/preventdefault-vs-stoppropagation-vs-stopimmediatepropagation/" target="_blank" rel="external">PREVENTDEFAULT VS. STOPPROPAGATION VS. STOPIMMEDIATEPROPAGATION</a></li>
<li><a href="http://stackoverflow.com/questions/10712219/remove-onclick-event-from-img-tag" target="_blank" rel="external">Remove onclick event from img tag</a></li>
<li><a href="http://stackoverflow.com/questions/5302903/jquery-event-stopimmediatepropagation-vs-return-false" target="_blank" rel="external">jquery: event.stopImmediatePropagation() vs return false</a></li>
<li><a href="http://fuelyourcoding.com/jquery-events-stop-misusing-return-false/" target="_blank" rel="external">jQuery Events: Stop (Mis)Using Return False</a></li>
<li><a href="http://www.quirksmode.org/js/events_order.html" target="_blank" rel="external">Event order</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;遇到一个问题：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;A&lt;/code&gt;标签跳转前需要做一下登录判断，如果未登录则不让跳转，使用preventDefault发现阻止不了&lt;code&gt;A&lt;/code&gt;标签的跳转。&lt;/p&gt;
&lt;p&gt;解决方法：&lt;/p&gt;
&lt;p&gt;加上stopImmediatePropagation才行。当然也可以把&lt;code&gt;A&lt;/code&gt;标签的&lt;code&gt;href&lt;/code&gt;属性设置为空，通过js来控制跳转，但改动略大些，忽视。&lt;/p&gt;
&lt;p&gt;于是正好借此机会整理和收集一下JavaScript中的event事件。&lt;/p&gt;
    
    </summary>
    
    
      <category term="JS" scheme="http://xchb.work/tags/JS/"/>
    
  </entry>
  
  <entry>
    <title>浏览器工作原理</title>
    <link href="http://xchb.work/2016/07/21/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/"/>
    <id>http://xchb.work/2016/07/21/浏览器工作原理/</id>
    <published>2016-07-21T12:06:49.000Z</published>
    <updated>2016-07-22T02:41:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>整理和收集一下浏览器渲染原理。</p>
<h2 id="解析和展示html流程"><a href="#解析和展示html流程" class="headerlink" title="解析和展示html流程"></a>解析和展示html流程</h2><ol>
<li>首先下载html文件</li>
<li>解析html，构建dom树</li>
<li>和css结合生成渲染树</li>
<li>绘制并展示页面</li>
</ol>
<a id="more"></a>
<p>图示：<br><img src="http://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/flow.png" alt="渲染流程"></p>
<p><img src="http://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/webkitflow.png" alt="Webkit"></p>
<p><img src="http://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image008.jpg" alt="Gecko"></p>
<p><a href="http://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/" target="_blank" rel="external">图片来源:http://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/</a></p>
<h2 id="CSSOM和DOM组合-gt-render-tree-（渲染树）"><a href="#CSSOM和DOM组合-gt-render-tree-（渲染树）" class="headerlink" title="CSSOM和DOM组合 -&gt; render tree （渲染树）"></a>CSSOM和DOM组合 -&gt; render tree （渲染树）</h2><p><img src="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/images/render-tree-construction.png" alt="combile CSSOM and DOM"><br><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction" target="_blank" rel="external">图片来源：https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction</a></p>
<h2 id="相关文章："><a href="#相关文章：" class="headerlink" title="相关文章："></a>相关文章：</h2><ol>
<li><a href="http://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/" target="_blank" rel="external">浏览器工作原理</a></li>
<li><a href="http://taligarsiel.com/Projects/howbrowserswork1.htm" target="_blank" rel="external">How browsers work</a></li>
<li><a href="https://css-tricks.com/efficiently-rendering-css/" target="_blank" rel="external">EfficientlyRendering CSS</a></li>
<li><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction" target="_blank" rel="external">Render-tree construction, layout, and paint</a></li>
<li><a href="http://calendar.perfplanet.com/2011/css-selector-performance-has-changed-for-the-better/" target="_blank" rel="external">CSS Selector Performance has changed! (For the better)</a></li>
<li><a href="https://dl.dropboxusercontent.com/u/39519/talks/cssperf/index.html" target="_blank" rel="external">CSS PERFORMANCE</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Style_System_Overview" target="_blank" rel="external">Style System Overview</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;整理和收集一下浏览器渲染原理。&lt;/p&gt;
&lt;h2 id=&quot;解析和展示html流程&quot;&gt;&lt;a href=&quot;#解析和展示html流程&quot; class=&quot;headerlink&quot; title=&quot;解析和展示html流程&quot;&gt;&lt;/a&gt;解析和展示html流程&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;首先下载html文件&lt;/li&gt;
&lt;li&gt;解析html，构建dom树&lt;/li&gt;
&lt;li&gt;和css结合生成渲染树&lt;/li&gt;
&lt;li&gt;绘制并展示页面&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="Web" scheme="http://xchb.work/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>React-Todo示例</title>
    <link href="http://xchb.work/2016/05/25/React-Todo%E7%A4%BA%E4%BE%8B/"/>
    <id>http://xchb.work/2016/05/25/React-Todo示例/</id>
    <published>2016-05-25T12:47:25.000Z</published>
    <updated>2016-05-26T06:36:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>近两天事情较少，准备做一个书单列表，初始阶段和之前看过的Todo基本相似。正好很久没看React，感觉好生疏，准备结合ES6重新写一个React的Todo示例。参考的源码和样式来源于<a href="http://todomvc.com/examples/react/#/" target="_blank" rel="external">todomvc</a></p>
<a id="more"></a>
<h3 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h3><p>直接复用todomvc的，这个样式很简洁，同时该网站又把相关的css都放在同一个css文件中，直接下载下来就可以了。</p>
<h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p>参考其<a href="https://github.com/tastejs/todomvc/tree/gh-pages/examples/react" target="_blank" rel="external">示例源码</a>,<br>但是由于其源码用的不是ES6，同时用的是IEEF来做的模块化，所以需要改造一下。</p>
<p>改造点：</p>
<ol>
<li>在ES6中，可以直接用<code>class</code>扩展<code>React.Component</code>(注意大写首字母，跳过这个坑)</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoFooter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            <span class="xml"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">className</span>=<span class="string">"footer"</span>&gt;</span></span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">"todo-count"</span>&gt;</span>&#123;this.props.count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">"filters"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>All<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>Active<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>Complete<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个是改造TodoFooter的代码。<br>在其他模块引用时，只需要<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> TodoFooter <span class="keyword">from</span> <span class="string">'./todoFooter.jsx'</span>;</div></pre></td></tr></table></figure></p>
<ol>
<li><p><code>classNames</code> 模块已经单独抽出来维护了，<a href="https://github.com/JedWatson/classnames" target="_blank" rel="external">classnames的github地址</a></p>
</li>
<li><p>ES6中，React不会默认绑定<code>this</code>，所以需要手动绑定一下</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React from <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> classNames from <span class="string">'classnames'</span>;</div><div class="line"></div><div class="line">export <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoItem</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(props) &#123;</div><div class="line">        <span class="keyword">super</span>(props);</div><div class="line">        <span class="keyword">this</span>.state = &#123;</div><div class="line">            editText: <span class="keyword">this</span>.props.todo.title</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">this</span>.id = <span class="keyword">this</span>.props.itemId;</div><div class="line">        <span class="keyword">this</span>.handleSubmit = <span class="keyword">this</span>.handleSubmit.bind(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.handleChange = <span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.handleEdit = <span class="keyword">this</span>.handleEdit.bind(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.handleKeyDown  = <span class="keyword">this</span>.handleKeyDown.bind(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.onToggle = <span class="keyword">this</span>.onToggle.bind(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">this</span>.onDestroy = <span class="keyword">this</span>.onDestroy.bind(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    handleSubmit() &#123;</div><div class="line">        <span class="keyword">var</span> <span class="keyword">val</span> = <span class="keyword">this</span>.state.editText.trim();</div><div class="line">        <span class="keyword">if</span> (!<span class="keyword">val</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.props.onDestroy(<span class="keyword">this</span>.id);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">this</span>.props.onSave(<span class="keyword">this</span>.id, <span class="keyword">val</span>);</div><div class="line">            <span class="keyword">this</span>.setState(&#123;editText: <span class="keyword">val</span>&#125;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    handleEdit() &#123;</div><div class="line">        <span class="keyword">this</span>.props.onEdit(<span class="keyword">this</span>.id);</div><div class="line">        <span class="keyword">this</span>.setState(&#123;editText: <span class="keyword">this</span>.props.todo.title&#125;);</div><div class="line">    &#125;</div><div class="line">    handleKeyDown(e) &#123;</div><div class="line">        <span class="keyword">if</span> (e.which === <span class="number">27</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;editText: <span class="keyword">this</span>.props.todo.title&#125;);</div><div class="line">            <span class="keyword">this</span>.props.onCancel(event);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (e.which === <span class="number">13</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.handleSubmit(e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    handleChange(e) &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.props.editing) &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;editText: e.target.value&#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    onToggle() &#123;</div><div class="line">        <span class="keyword">this</span>.props.onToggle(<span class="keyword">this</span>.id);</div><div class="line">    &#125;</div><div class="line">    onDestroy() &#123;</div><div class="line">        <span class="keyword">this</span>.props.onDestroy(<span class="keyword">this</span>.id);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            &lt;li className=&#123;classNames(&#123;</div><div class="line">                completed: <span class="keyword">this</span>.props.todo.completed,</div><div class="line">                editing: <span class="keyword">this</span>.props.editing</div><div class="line">            &#125;)&#125;</div><div class="line">            &gt;</div><div class="line">                &lt;div className=<span class="string">"view"</span>&gt;</div><div class="line">                    &lt;input</div><div class="line">                        className=<span class="string">"toggle"</span></div><div class="line">                        type=<span class="string">"checkbox"</span></div><div class="line">                        checked=&#123;<span class="keyword">this</span>.props.todo.completed&#125;</div><div class="line">                        onChange=&#123;<span class="keyword">this</span>.onToggle&#125;</div><div class="line">                    /&gt;</div><div class="line">                    &lt;label onDoubleClick=&#123;<span class="keyword">this</span>.handleEdit&#125;&gt;</div><div class="line">                        &#123;<span class="keyword">this</span>.props.todo.title&#125;</div><div class="line">                    &lt;/label&gt;</div><div class="line">                    &lt;button className=<span class="string">"destroy"</span> onClick=&#123;<span class="keyword">this</span>.onDestroy&#125;&gt;&lt;/button&gt;</div><div class="line">                &lt;/div&gt;</div><div class="line">                &lt;input</div><div class="line">                    ref=<span class="string">"editField"</span></div><div class="line">                    className=<span class="string">"edit"</span></div><div class="line">                    value=&#123;<span class="keyword">this</span>.state.editText&#125;</div><div class="line">                    onBlur=&#123;<span class="keyword">this</span>.handleSubmit&#125;</div><div class="line">                    onChange=&#123;<span class="keyword">this</span>.handleChange&#125;</div><div class="line">                    onKeyDown=&#123;<span class="keyword">this</span>.handleKeyDown&#125;</div><div class="line">                /&gt;</div><div class="line">            &lt;/li&gt;</div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>事件传递参数，用<code>bind</code></p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onClick</span>=<span class="string">&#123;this.props.onFilter.bind(this,</span> <span class="attr">ALL_TODOS</span>)&#125; <span class="attr">className</span>=<span class="string">&#123;classNames(&#123;selected:</span> <span class="attr">active</span> === <span class="string">ALL_TODOS&#125;)&#125;</span>&gt;</span>All<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;近两天事情较少，准备做一个书单列表，初始阶段和之前看过的Todo基本相似。正好很久没看React，感觉好生疏，准备结合ES6重新写一个React的Todo示例。参考的源码和样式来源于&lt;a href=&quot;http://todomvc.com/examples/react/#/&quot;&gt;todomvc&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="React" scheme="http://xchb.work/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>图片加载</title>
    <link href="http://xchb.work/2016/05/23/%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD/"/>
    <id>http://xchb.work/2016/05/23/图片加载/</id>
    <published>2016-05-23T03:55:34.000Z</published>
    <updated>2016-05-23T05:46:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>随着网页内容越来越丰富，页面的图片也越来越多，导致页面加载越来越慢。针对页面的优化，图片加载是一个重点。常见的优化方案有图片预加载，图片惰性加载。或者针对图片格式做一些优化，例如使用webp之类的。这里主要关注图片的加载方式。</p>
<a id="more"></a>
<h2 id="图片预加载"><a href="#图片预加载" class="headerlink" title="图片预加载"></a>图片预加载</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>图片的加载速度往往影响着网站整体的用户体验，尤其对于包含大量图片的网站。对图片进行预加载，不失为一个高效的解决方案。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>使用CSS3、JavaScript、Ajax实现图片预加载</p>
<h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><ol>
<li><a href="https://perishablepress.com/3-ways-preload-images-css-javascript-ajax/" target="_blank" rel="external">3 Ways to Preload Images with CSS, JavaScript, or Ajax</a></li>
<li><a href="http://www.csdn.net/article/2013-10-15/2817187-3-ways-preload-images-css-javascript-ajax" target="_blank" rel="external">利用CSS、JavaScript及Ajax实现图片预加载的三大方法</a></li>
</ol>
<h2 id="图片惰性加载"><a href="#图片惰性加载" class="headerlink" title="图片惰性加载"></a>图片惰性加载</h2><h3 id="背景-1"><a href="#背景-1" class="headerlink" title="背景"></a>背景</h3><p>页面图片较多，影响加载速度，而且很多时候，页面加载完了，用户却不会滑动到页面最下面，也就是说加载出来的图片，用户更本就没去看，造成资源浪费的同时也使得页面加载变慢。</p>
<h3 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h3><p>按需加载图片，如果用户滚动到图片位置，则加载图片。</p>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><ol>
<li>给<code>img</code>标签设置src为一个loading图标，然后把实际的图片地址存储到其他自定义属性中；</li>
<li>监听页面滚动事件，如果页面滚动到图片区域，则替换src为图片的视觉地址。</li>
</ol>
<p>示例：</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;img data-original=<span class="symbol">'actual</span>.jpg' src=<span class="symbol">'loading</span>.gif'/&gt;</div></pre></td></tr></table></figure>
<h3 id="具体实现-1"><a href="#具体实现-1" class="headerlink" title="具体实现"></a>具体实现</h3><ol>
<li>参考<a href="http://www.cnblogs.com/zichi/p/5021697.html" target="_blank" rel="external">教你实现图片的惰性加载</a></li>
<li>使用jQuery的<a href="https://plugins.jquery.com/lazyload/" target="_blank" rel="external">惰性加载库（lazyload）</a>, <a href="https://github.com/tuupola/jquery_lazyload" target="_blank" rel="external">github地址</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;随着网页内容越来越丰富，页面的图片也越来越多，导致页面加载越来越慢。针对页面的优化，图片加载是一个重点。常见的优化方案有图片预加载，图片惰性加载。或者针对图片格式做一些优化，例如使用webp之类的。这里主要关注图片的加载方式。&lt;/p&gt;
    
    </summary>
    
    
      <category term="HTML" scheme="http://xchb.work/tags/HTML/"/>
    
  </entry>
  
</feed>
